{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callModuleDestroyHook = callModuleDestroyHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Returns true or false if the given instance has a `onModuleDestroy` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasOnModuleDestroyHook(instance) {\n  return (0, shared_utils_1.isFunction)(instance.onModuleDestroy);\n}\n/**\n * Calls the given instances onModuleDestroy hook\n */\nfunction callOperator(instances) {\n  return (0, iterare_1.iterate)(instances).filter(instance => !(0, shared_utils_1.isNil)(instance)).filter(hasOnModuleDestroyHook).map( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (instance) {\n      return instance.onModuleDestroy();\n    });\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()).toArray();\n}\n/**\n * Calls the `onModuleDestroy` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n */\nfunction callModuleDestroyHook(_x2) {\n  return _callModuleDestroyHook.apply(this, arguments);\n}\nfunction _callModuleDestroyHook() {\n  _callModuleDestroyHook = _asyncToGenerator(function* (module) {\n    const providers = module.getNonAliasProviders();\n    // Module (class) instance is the first element of the providers array\n    // Lifecycle hook has to be called once all classes are properly destroyed\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [...module.controllers, ...providers, ...module.injectables, ...module.middlewares];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    yield Promise.all(callOperator(nonTransientInstances));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    yield Promise.all(callOperator(transientInstances));\n    // Call the module instance itself\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance && hasOnModuleDestroyHook(moduleClassInstance) && moduleClassHost.isDependencyTreeStatic()) {\n      yield moduleClassInstance.onModuleDestroy();\n    }\n  });\n  return _callModuleDestroyHook.apply(this, arguments);\n}","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","callModuleDestroyHook","shared_utils_1","iterare_1","transient_instances_1","hasOnModuleDestroyHook","instance","isFunction","onModuleDestroy","callOperator","instances","iterate","filter","isNil","map","_ref","_x","apply","arguments","toArray","_x2","_callModuleDestroyHook","module","providers","getNonAliasProviders","_","moduleClassHost","shift","controllers","injectables","middlewares","nonTransientInstances","getNonTransientInstances","Promise","all","transientInstances","getTransientInstances","moduleClassInstance","isDependencyTreeStatic"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/hooks/on-module-destroy.hook.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.callModuleDestroyHook = callModuleDestroyHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Returns true or false if the given instance has a `onModuleDestroy` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasOnModuleDestroyHook(instance) {\n    return (0, shared_utils_1.isFunction)(instance.onModuleDestroy);\n}\n/**\n * Calls the given instances onModuleDestroy hook\n */\nfunction callOperator(instances) {\n    return (0, iterare_1.iterate)(instances)\n        .filter(instance => !(0, shared_utils_1.isNil)(instance))\n        .filter(hasOnModuleDestroyHook)\n        .map(async (instance) => instance.onModuleDestroy())\n        .toArray();\n}\n/**\n * Calls the `onModuleDestroy` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n */\nasync function callModuleDestroyHook(module) {\n    const providers = module.getNonAliasProviders();\n    // Module (class) instance is the first element of the providers array\n    // Lifecycle hook has to be called once all classes are properly destroyed\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [\n        ...module.controllers,\n        ...providers,\n        ...module.injectables,\n        ...module.middlewares,\n    ];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    await Promise.all(callOperator(nonTransientInstances));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    await Promise.all(callOperator(transientInstances));\n    // Call the module instance itself\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance &&\n        hasOnModuleDestroyHook(moduleClassInstance) &&\n        moduleClassHost.isDependencyTreeStatic()) {\n        await moduleClassInstance.onModuleDestroy();\n    }\n}\n"],"mappings":"AAAA,YAAY;;AAAC,IAAAA,iBAAA,GAAAC,OAAA,wHAAAC,OAAA;AACbC,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,qBAAqB,GAAGA,qBAAqB;AACrD,MAAMC,cAAc,GAAGP,OAAO,CAAC,mCAAmC,CAAC;AACnE,MAAMQ,SAAS,GAAGR,OAAO,CAAC,SAAS,CAAC;AACpC,MAAMS,qBAAqB,GAAGT,OAAO,CAAC,yCAAyC,CAAC;AAChF;AACA;AACA;AACA;AACA;AACA,SAASU,sBAAsBA,CAACC,QAAQ,EAAE;EACtC,OAAO,CAAC,CAAC,EAAEJ,cAAc,CAACK,UAAU,EAAED,QAAQ,CAACE,eAAe,CAAC;AACnE;AACA;AACA;AACA;AACA,SAASC,YAAYA,CAACC,SAAS,EAAE;EAC7B,OAAO,CAAC,CAAC,EAAEP,SAAS,CAACQ,OAAO,EAAED,SAAS,CAAC,CACnCE,MAAM,CAACN,QAAQ,IAAI,CAAC,CAAC,CAAC,EAAEJ,cAAc,CAACW,KAAK,EAAEP,QAAQ,CAAC,CAAC,CACxDM,MAAM,CAACP,sBAAsB,CAAC,CAC9BS,GAAG;IAAA,IAAAC,IAAA,GAAArB,iBAAA,CAAC,WAAOY,QAAQ;MAAA,OAAKA,QAAQ,CAACE,eAAe,CAAC,CAAC;IAAA;IAAA,iBAAAQ,EAAA;MAAA,OAAAD,IAAA,CAAAE,KAAA,OAAAC,SAAA;IAAA;EAAA,IAAC,CACnDC,OAAO,CAAC,CAAC;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AALA,SAMelB,qBAAqBA,CAAAmB,GAAA;EAAA,OAAAC,sBAAA,CAAAJ,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAG,uBAAA;EAAAA,sBAAA,GAAA3B,iBAAA,CAApC,WAAqC4B,MAAM,EAAE;IACzC,MAAMC,SAAS,GAAGD,MAAM,CAACE,oBAAoB,CAAC,CAAC;IAC/C;IACA;IACA,MAAM,CAACC,CAAC,EAAEC,eAAe,CAAC,GAAGH,SAAS,CAACI,KAAK,CAAC,CAAC;IAC9C,MAAMjB,SAAS,GAAG,CACd,GAAGY,MAAM,CAACM,WAAW,EACrB,GAAGL,SAAS,EACZ,GAAGD,MAAM,CAACO,WAAW,EACrB,GAAGP,MAAM,CAACQ,WAAW,CACxB;IACD,MAAMC,qBAAqB,GAAG,CAAC,CAAC,EAAE3B,qBAAqB,CAAC4B,wBAAwB,EAAEtB,SAAS,CAAC;IAC5F,MAAMuB,OAAO,CAACC,GAAG,CAACzB,YAAY,CAACsB,qBAAqB,CAAC,CAAC;IACtD,MAAMI,kBAAkB,GAAG,CAAC,CAAC,EAAE/B,qBAAqB,CAACgC,qBAAqB,EAAE1B,SAAS,CAAC;IACtF,MAAMuB,OAAO,CAACC,GAAG,CAACzB,YAAY,CAAC0B,kBAAkB,CAAC,CAAC;IACnD;IACA,MAAME,mBAAmB,GAAGX,eAAe,CAACpB,QAAQ;IACpD,IAAI+B,mBAAmB,IACnBhC,sBAAsB,CAACgC,mBAAmB,CAAC,IAC3CX,eAAe,CAACY,sBAAsB,CAAC,CAAC,EAAE;MAC1C,MAAMD,mBAAmB,CAAC7B,eAAe,CAAC,CAAC;IAC/C;EACJ,CAAC;EAAA,OAAAa,sBAAA,CAAAJ,KAAA,OAAAC,SAAA;AAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}