{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.InterceptorsConsumer = void 0;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst async_hooks_1 = require(\"async_hooks\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst execution_context_host_1 = require(\"../helpers/execution-context-host\");\nclass InterceptorsConsumer {\n  intercept(interceptors, args, instance, callback, next, type) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      if ((0, shared_utils_1.isEmpty)(interceptors)) {\n        return next();\n      }\n      const context = _this.createContext(args, instance, callback);\n      context.setType(type);\n      const _nextFn = /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (i = 0) {\n          if (i >= interceptors.length) {\n            return (0, rxjs_1.defer)(async_hooks_1.AsyncResource.bind(() => _this.transformDeferred(next)));\n          }\n          const handler = {\n            handle: () => (0, rxjs_1.defer)(async_hooks_1.AsyncResource.bind(() => _nextFn(i + 1))).pipe((0, operators_1.mergeAll)())\n          };\n          return interceptors[i].intercept(context, handler);\n        });\n        return function nextFn() {\n          return _ref.apply(this, arguments);\n        };\n      }();\n      return (0, rxjs_1.defer)(() => _nextFn()).pipe((0, operators_1.mergeAll)());\n    })();\n  }\n  createContext(args, instance, callback) {\n    return new execution_context_host_1.ExecutionContextHost(args, instance.constructor, callback);\n  }\n  transformDeferred(next) {\n    return (0, rxjs_1.from)(next()).pipe((0, operators_1.switchMap)(res => {\n      const isDeferred = res instanceof Promise || res instanceof rxjs_1.Observable;\n      return isDeferred ? res : Promise.resolve(res);\n    }));\n  }\n}\nexports.InterceptorsConsumer = InterceptorsConsumer;","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","InterceptorsConsumer","shared_utils_1","async_hooks_1","rxjs_1","operators_1","execution_context_host_1","intercept","interceptors","args","instance","callback","next","type","_this","isEmpty","context","createContext","setType","nextFn","_ref","i","length","defer","AsyncResource","bind","transformDeferred","handler","handle","pipe","mergeAll","apply","arguments","ExecutionContextHost","constructor","from","switchMap","res","isDeferred","Promise","Observable","resolve"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/interceptors/interceptors-consumer.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.InterceptorsConsumer = void 0;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst async_hooks_1 = require(\"async_hooks\");\nconst rxjs_1 = require(\"rxjs\");\nconst operators_1 = require(\"rxjs/operators\");\nconst execution_context_host_1 = require(\"../helpers/execution-context-host\");\nclass InterceptorsConsumer {\n    async intercept(interceptors, args, instance, callback, next, type) {\n        if ((0, shared_utils_1.isEmpty)(interceptors)) {\n            return next();\n        }\n        const context = this.createContext(args, instance, callback);\n        context.setType(type);\n        const nextFn = async (i = 0) => {\n            if (i >= interceptors.length) {\n                return (0, rxjs_1.defer)(async_hooks_1.AsyncResource.bind(() => this.transformDeferred(next)));\n            }\n            const handler = {\n                handle: () => (0, rxjs_1.defer)(async_hooks_1.AsyncResource.bind(() => nextFn(i + 1))).pipe((0, operators_1.mergeAll)()),\n            };\n            return interceptors[i].intercept(context, handler);\n        };\n        return (0, rxjs_1.defer)(() => nextFn()).pipe((0, operators_1.mergeAll)());\n    }\n    createContext(args, instance, callback) {\n        return new execution_context_host_1.ExecutionContextHost(args, instance.constructor, callback);\n    }\n    transformDeferred(next) {\n        return (0, rxjs_1.from)(next()).pipe((0, operators_1.switchMap)(res => {\n            const isDeferred = res instanceof Promise || res instanceof rxjs_1.Observable;\n            return isDeferred ? res : Promise.resolve(res);\n        }));\n    }\n}\nexports.InterceptorsConsumer = InterceptorsConsumer;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}