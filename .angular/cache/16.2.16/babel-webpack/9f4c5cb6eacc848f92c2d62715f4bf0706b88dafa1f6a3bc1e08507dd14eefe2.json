{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callBeforeAppShutdownHook = callBeforeAppShutdownHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Checks if the given instance has the `beforeApplicationShutdown` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasBeforeApplicationShutdownHook(instance) {\n  return (0, shared_utils_1.isFunction)(instance.beforeApplicationShutdown);\n}\n/**\n * Calls the given instances\n */\nfunction callOperator(instances, signal) {\n  return (0, iterare_1.iterate)(instances).filter(instance => !(0, shared_utils_1.isNil)(instance)).filter(hasBeforeApplicationShutdownHook).map( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (instance) {\n      return instance.beforeApplicationShutdown(signal);\n    });\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()).toArray();\n}\n/**\n * Calls the `beforeApplicationShutdown` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n * @param signal The signal which caused the shutdown\n */\nfunction callBeforeAppShutdownHook(_x2, _x3) {\n  return _callBeforeAppShutdownHook.apply(this, arguments);\n}\nfunction _callBeforeAppShutdownHook() {\n  _callBeforeAppShutdownHook = _asyncToGenerator(function* (module, signal) {\n    const providers = module.getNonAliasProviders();\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [...module.controllers, ...providers, ...module.injectables, ...module.middlewares];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    yield Promise.all(callOperator(nonTransientInstances, signal));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    yield Promise.all(callOperator(transientInstances, signal));\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance && hasBeforeApplicationShutdownHook(moduleClassInstance) && moduleClassHost.isDependencyTreeStatic()) {\n      yield moduleClassInstance.beforeApplicationShutdown(signal);\n    }\n  });\n  return _callBeforeAppShutdownHook.apply(this, arguments);\n}","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","callBeforeAppShutdownHook","shared_utils_1","iterare_1","transient_instances_1","hasBeforeApplicationShutdownHook","instance","isFunction","beforeApplicationShutdown","callOperator","instances","signal","iterate","filter","isNil","map","_ref","_x","apply","arguments","toArray","_x2","_x3","_callBeforeAppShutdownHook","module","providers","getNonAliasProviders","_","moduleClassHost","shift","controllers","injectables","middlewares","nonTransientInstances","getNonTransientInstances","Promise","all","transientInstances","getTransientInstances","moduleClassInstance","isDependencyTreeStatic"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/hooks/before-app-shutdown.hook.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.callBeforeAppShutdownHook = callBeforeAppShutdownHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Checks if the given instance has the `beforeApplicationShutdown` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasBeforeApplicationShutdownHook(instance) {\n    return (0, shared_utils_1.isFunction)(instance.beforeApplicationShutdown);\n}\n/**\n * Calls the given instances\n */\nfunction callOperator(instances, signal) {\n    return (0, iterare_1.iterate)(instances)\n        .filter(instance => !(0, shared_utils_1.isNil)(instance))\n        .filter(hasBeforeApplicationShutdownHook)\n        .map(async (instance) => instance.beforeApplicationShutdown(signal))\n        .toArray();\n}\n/**\n * Calls the `beforeApplicationShutdown` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n * @param signal The signal which caused the shutdown\n */\nasync function callBeforeAppShutdownHook(module, signal) {\n    const providers = module.getNonAliasProviders();\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [\n        ...module.controllers,\n        ...providers,\n        ...module.injectables,\n        ...module.middlewares,\n    ];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    await Promise.all(callOperator(nonTransientInstances, signal));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    await Promise.all(callOperator(transientInstances, signal));\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance &&\n        hasBeforeApplicationShutdownHook(moduleClassInstance) &&\n        moduleClassHost.isDependencyTreeStatic()) {\n        await moduleClassInstance.beforeApplicationShutdown(signal);\n    }\n}\n"],"mappings":"AAAA,YAAY;;AAAC,IAAAA,iBAAA,GAAAC,OAAA,wHAAAC,OAAA;AACbC,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,yBAAyB,GAAGA,yBAAyB;AAC7D,MAAMC,cAAc,GAAGP,OAAO,CAAC,mCAAmC,CAAC;AACnE,MAAMQ,SAAS,GAAGR,OAAO,CAAC,SAAS,CAAC;AACpC,MAAMS,qBAAqB,GAAGT,OAAO,CAAC,yCAAyC,CAAC;AAChF;AACA;AACA;AACA;AACA;AACA,SAASU,gCAAgCA,CAACC,QAAQ,EAAE;EAChD,OAAO,CAAC,CAAC,EAAEJ,cAAc,CAACK,UAAU,EAAED,QAAQ,CAACE,yBAAyB,CAAC;AAC7E;AACA;AACA;AACA;AACA,SAASC,YAAYA,CAACC,SAAS,EAAEC,MAAM,EAAE;EACrC,OAAO,CAAC,CAAC,EAAER,SAAS,CAACS,OAAO,EAAEF,SAAS,CAAC,CACnCG,MAAM,CAACP,QAAQ,IAAI,CAAC,CAAC,CAAC,EAAEJ,cAAc,CAACY,KAAK,EAAER,QAAQ,CAAC,CAAC,CACxDO,MAAM,CAACR,gCAAgC,CAAC,CACxCU,GAAG;IAAA,IAAAC,IAAA,GAAAtB,iBAAA,CAAC,WAAOY,QAAQ;MAAA,OAAKA,QAAQ,CAACE,yBAAyB,CAACG,MAAM,CAAC;IAAA;IAAA,iBAAAM,EAAA;MAAA,OAAAD,IAAA,CAAAE,KAAA,OAAAC,SAAA;IAAA;EAAA,IAAC,CACnEC,OAAO,CAAC,CAAC;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA,SAOenB,yBAAyBA,CAAAoB,GAAA,EAAAC,GAAA;EAAA,OAAAC,0BAAA,CAAAL,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAI,2BAAA;EAAAA,0BAAA,GAAA7B,iBAAA,CAAxC,WAAyC8B,MAAM,EAAEb,MAAM,EAAE;IACrD,MAAMc,SAAS,GAAGD,MAAM,CAACE,oBAAoB,CAAC,CAAC;IAC/C,MAAM,CAACC,CAAC,EAAEC,eAAe,CAAC,GAAGH,SAAS,CAACI,KAAK,CAAC,CAAC;IAC9C,MAAMnB,SAAS,GAAG,CACd,GAAGc,MAAM,CAACM,WAAW,EACrB,GAAGL,SAAS,EACZ,GAAGD,MAAM,CAACO,WAAW,EACrB,GAAGP,MAAM,CAACQ,WAAW,CACxB;IACD,MAAMC,qBAAqB,GAAG,CAAC,CAAC,EAAE7B,qBAAqB,CAAC8B,wBAAwB,EAAExB,SAAS,CAAC;IAC5F,MAAMyB,OAAO,CAACC,GAAG,CAAC3B,YAAY,CAACwB,qBAAqB,EAAEtB,MAAM,CAAC,CAAC;IAC9D,MAAM0B,kBAAkB,GAAG,CAAC,CAAC,EAAEjC,qBAAqB,CAACkC,qBAAqB,EAAE5B,SAAS,CAAC;IACtF,MAAMyB,OAAO,CAACC,GAAG,CAAC3B,YAAY,CAAC4B,kBAAkB,EAAE1B,MAAM,CAAC,CAAC;IAC3D,MAAM4B,mBAAmB,GAAGX,eAAe,CAACtB,QAAQ;IACpD,IAAIiC,mBAAmB,IACnBlC,gCAAgC,CAACkC,mBAAmB,CAAC,IACrDX,eAAe,CAACY,sBAAsB,CAAC,CAAC,EAAE;MAC1C,MAAMD,mBAAmB,CAAC/B,yBAAyB,CAACG,MAAM,CAAC;IAC/D;EACJ,CAAC;EAAA,OAAAY,0BAAA,CAAAL,KAAA,OAAAC,SAAA;AAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}