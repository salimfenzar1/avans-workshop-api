{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.GuardsContextCreator = void 0;\nconst constants_1 = require(\"@nestjs/common/constants\");\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst context_creator_1 = require(\"../helpers/context-creator\");\nconst constants_2 = require(\"../injector/constants\");\nclass GuardsContextCreator extends context_creator_1.ContextCreator {\n  constructor(container, config) {\n    super();\n    this.container = container;\n    this.config = config;\n  }\n  create(instance, callback, module, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n    this.moduleContext = module;\n    return this.createContext(instance, callback, constants_1.GUARDS_METADATA, contextId, inquirerId);\n  }\n  createConcreteContext(metadata, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n    if ((0, shared_utils_1.isEmpty)(metadata)) {\n      return [];\n    }\n    return (0, iterare_1.iterate)(metadata).filter(guard => guard && (guard.name || guard.canActivate)).map(guard => this.getGuardInstance(guard, contextId, inquirerId)).filter(guard => guard && (0, shared_utils_1.isFunction)(guard.canActivate)).toArray();\n  }\n  getGuardInstance(metatype, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n    const isObject = metatype.canActivate;\n    if (isObject) {\n      return metatype;\n    }\n    const instanceWrapper = this.getInstanceByMetatype(metatype);\n    if (!instanceWrapper) {\n      return null;\n    }\n    const instanceHost = instanceWrapper.getInstanceByContextId(this.getContextId(contextId, instanceWrapper), inquirerId);\n    return instanceHost && instanceHost.instance;\n  }\n  getInstanceByMetatype(metatype) {\n    if (!this.moduleContext) {\n      return;\n    }\n    const collection = this.container.getModules();\n    const moduleRef = collection.get(this.moduleContext);\n    if (!moduleRef) {\n      return;\n    }\n    const injectables = moduleRef.injectables;\n    return injectables.get(metatype);\n  }\n  getGlobalMetadata(contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n    if (!this.config) {\n      return [];\n    }\n    const globalGuards = this.config.getGlobalGuards();\n    if (contextId === constants_2.STATIC_CONTEXT && !inquirerId) {\n      return globalGuards;\n    }\n    const scopedGuardWrappers = this.config.getGlobalRequestGuards();\n    const scopedGuards = (0, iterare_1.iterate)(scopedGuardWrappers).map(wrapper => wrapper.getInstanceByContextId(this.getContextId(contextId, wrapper), inquirerId)).filter(host => !!host).map(host => host.instance).toArray();\n    return globalGuards.concat(scopedGuards);\n  }\n}\nexports.GuardsContextCreator = GuardsContextCreator;","map":{"version":3,"names":["Object","defineProperty","exports","value","GuardsContextCreator","constants_1","require","shared_utils_1","iterare_1","context_creator_1","constants_2","ContextCreator","constructor","container","config","create","instance","callback","module","contextId","STATIC_CONTEXT","inquirerId","moduleContext","createContext","GUARDS_METADATA","createConcreteContext","metadata","isEmpty","iterate","filter","guard","name","canActivate","map","getGuardInstance","isFunction","toArray","metatype","isObject","instanceWrapper","getInstanceByMetatype","instanceHost","getInstanceByContextId","getContextId","collection","getModules","moduleRef","get","injectables","getGlobalMetadata","globalGuards","getGlobalGuards","scopedGuardWrappers","getGlobalRequestGuards","scopedGuards","wrapper","host","concat"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/guards/guards-context-creator.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.GuardsContextCreator = void 0;\nconst constants_1 = require(\"@nestjs/common/constants\");\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst context_creator_1 = require(\"../helpers/context-creator\");\nconst constants_2 = require(\"../injector/constants\");\nclass GuardsContextCreator extends context_creator_1.ContextCreator {\n    constructor(container, config) {\n        super();\n        this.container = container;\n        this.config = config;\n    }\n    create(instance, callback, module, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n        this.moduleContext = module;\n        return this.createContext(instance, callback, constants_1.GUARDS_METADATA, contextId, inquirerId);\n    }\n    createConcreteContext(metadata, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n        if ((0, shared_utils_1.isEmpty)(metadata)) {\n            return [];\n        }\n        return (0, iterare_1.iterate)(metadata)\n            .filter((guard) => guard && (guard.name || guard.canActivate))\n            .map(guard => this.getGuardInstance(guard, contextId, inquirerId))\n            .filter((guard) => guard && (0, shared_utils_1.isFunction)(guard.canActivate))\n            .toArray();\n    }\n    getGuardInstance(metatype, contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n        const isObject = metatype.canActivate;\n        if (isObject) {\n            return metatype;\n        }\n        const instanceWrapper = this.getInstanceByMetatype(metatype);\n        if (!instanceWrapper) {\n            return null;\n        }\n        const instanceHost = instanceWrapper.getInstanceByContextId(this.getContextId(contextId, instanceWrapper), inquirerId);\n        return instanceHost && instanceHost.instance;\n    }\n    getInstanceByMetatype(metatype) {\n        if (!this.moduleContext) {\n            return;\n        }\n        const collection = this.container.getModules();\n        const moduleRef = collection.get(this.moduleContext);\n        if (!moduleRef) {\n            return;\n        }\n        const injectables = moduleRef.injectables;\n        return injectables.get(metatype);\n    }\n    getGlobalMetadata(contextId = constants_2.STATIC_CONTEXT, inquirerId) {\n        if (!this.config) {\n            return [];\n        }\n        const globalGuards = this.config.getGlobalGuards();\n        if (contextId === constants_2.STATIC_CONTEXT && !inquirerId) {\n            return globalGuards;\n        }\n        const scopedGuardWrappers = this.config.getGlobalRequestGuards();\n        const scopedGuards = (0, iterare_1.iterate)(scopedGuardWrappers)\n            .map(wrapper => wrapper.getInstanceByContextId(this.getContextId(contextId, wrapper), inquirerId))\n            .filter(host => !!host)\n            .map(host => host.instance)\n            .toArray();\n        return globalGuards.concat(scopedGuards);\n    }\n}\nexports.GuardsContextCreator = GuardsContextCreator;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}