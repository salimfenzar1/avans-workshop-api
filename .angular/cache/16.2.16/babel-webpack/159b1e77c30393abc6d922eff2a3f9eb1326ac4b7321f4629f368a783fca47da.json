{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.callAppShutdownHook = callAppShutdownHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Checks if the given instance has the `onApplicationShutdown` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasOnAppShutdownHook(instance) {\n  return (0, shared_utils_1.isFunction)(instance.onApplicationShutdown);\n}\n/**\n * Calls the given instances\n */\nfunction callOperator(instances, signal) {\n  return (0, iterare_1.iterate)(instances).filter(instance => !(0, shared_utils_1.isNil)(instance)).filter(hasOnAppShutdownHook).map( /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator(function* (instance) {\n      return instance.onApplicationShutdown(signal);\n    });\n    return function (_x) {\n      return _ref.apply(this, arguments);\n    };\n  }()).toArray();\n}\n/**\n * Calls the `onApplicationShutdown` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n * @param signal\n */\nfunction callAppShutdownHook(_x2, _x3) {\n  return _callAppShutdownHook.apply(this, arguments);\n}\nfunction _callAppShutdownHook() {\n  _callAppShutdownHook = _asyncToGenerator(function* (module, signal) {\n    const providers = module.getNonAliasProviders();\n    // Module (class) instance is the first element of the providers array\n    // Lifecycle hook has to be called once all classes are properly initialized\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [...module.controllers, ...providers, ...module.injectables, ...module.middlewares];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    yield Promise.all(callOperator(nonTransientInstances, signal));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    yield Promise.all(callOperator(transientInstances, signal));\n    // Call the instance itself\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance && hasOnAppShutdownHook(moduleClassInstance) && moduleClassHost.isDependencyTreeStatic()) {\n      yield moduleClassInstance.onApplicationShutdown(signal);\n    }\n  });\n  return _callAppShutdownHook.apply(this, arguments);\n}","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","callAppShutdownHook","shared_utils_1","iterare_1","transient_instances_1","hasOnAppShutdownHook","instance","isFunction","onApplicationShutdown","callOperator","instances","signal","iterate","filter","isNil","map","_ref","_x","apply","arguments","toArray","_x2","_x3","_callAppShutdownHook","module","providers","getNonAliasProviders","_","moduleClassHost","shift","controllers","injectables","middlewares","nonTransientInstances","getNonTransientInstances","Promise","all","transientInstances","getTransientInstances","moduleClassInstance","isDependencyTreeStatic"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/hooks/on-app-shutdown.hook.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.callAppShutdownHook = callAppShutdownHook;\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst iterare_1 = require(\"iterare\");\nconst transient_instances_1 = require(\"../injector/helpers/transient-instances\");\n/**\n * Checks if the given instance has the `onApplicationShutdown` function\n *\n * @param instance The instance which should be checked\n */\nfunction hasOnAppShutdownHook(instance) {\n    return (0, shared_utils_1.isFunction)(instance.onApplicationShutdown);\n}\n/**\n * Calls the given instances\n */\nfunction callOperator(instances, signal) {\n    return (0, iterare_1.iterate)(instances)\n        .filter(instance => !(0, shared_utils_1.isNil)(instance))\n        .filter(hasOnAppShutdownHook)\n        .map(async (instance) => instance.onApplicationShutdown(signal))\n        .toArray();\n}\n/**\n * Calls the `onApplicationShutdown` function on the module and its children\n * (providers / controllers).\n *\n * @param module The module which will be initialized\n * @param signal\n */\nasync function callAppShutdownHook(module, signal) {\n    const providers = module.getNonAliasProviders();\n    // Module (class) instance is the first element of the providers array\n    // Lifecycle hook has to be called once all classes are properly initialized\n    const [_, moduleClassHost] = providers.shift();\n    const instances = [\n        ...module.controllers,\n        ...providers,\n        ...module.injectables,\n        ...module.middlewares,\n    ];\n    const nonTransientInstances = (0, transient_instances_1.getNonTransientInstances)(instances);\n    await Promise.all(callOperator(nonTransientInstances, signal));\n    const transientInstances = (0, transient_instances_1.getTransientInstances)(instances);\n    await Promise.all(callOperator(transientInstances, signal));\n    // Call the instance itself\n    const moduleClassInstance = moduleClassHost.instance;\n    if (moduleClassInstance &&\n        hasOnAppShutdownHook(moduleClassInstance) &&\n        moduleClassHost.isDependencyTreeStatic()) {\n        await moduleClassInstance.onApplicationShutdown(signal);\n    }\n}\n"],"mappings":"AAAA,YAAY;;AAAC,IAAAA,iBAAA,GAAAC,OAAA,wHAAAC,OAAA;AACbC,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,mBAAmB,GAAGA,mBAAmB;AACjD,MAAMC,cAAc,GAAGP,OAAO,CAAC,mCAAmC,CAAC;AACnE,MAAMQ,SAAS,GAAGR,OAAO,CAAC,SAAS,CAAC;AACpC,MAAMS,qBAAqB,GAAGT,OAAO,CAAC,yCAAyC,CAAC;AAChF;AACA;AACA;AACA;AACA;AACA,SAASU,oBAAoBA,CAACC,QAAQ,EAAE;EACpC,OAAO,CAAC,CAAC,EAAEJ,cAAc,CAACK,UAAU,EAAED,QAAQ,CAACE,qBAAqB,CAAC;AACzE;AACA;AACA;AACA;AACA,SAASC,YAAYA,CAACC,SAAS,EAAEC,MAAM,EAAE;EACrC,OAAO,CAAC,CAAC,EAAER,SAAS,CAACS,OAAO,EAAEF,SAAS,CAAC,CACnCG,MAAM,CAACP,QAAQ,IAAI,CAAC,CAAC,CAAC,EAAEJ,cAAc,CAACY,KAAK,EAAER,QAAQ,CAAC,CAAC,CACxDO,MAAM,CAACR,oBAAoB,CAAC,CAC5BU,GAAG;IAAA,IAAAC,IAAA,GAAAtB,iBAAA,CAAC,WAAOY,QAAQ;MAAA,OAAKA,QAAQ,CAACE,qBAAqB,CAACG,MAAM,CAAC;IAAA;IAAA,iBAAAM,EAAA;MAAA,OAAAD,IAAA,CAAAE,KAAA,OAAAC,SAAA;IAAA;EAAA,IAAC,CAC/DC,OAAO,CAAC,CAAC;AAClB;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AANA,SAOenB,mBAAmBA,CAAAoB,GAAA,EAAAC,GAAA;EAAA,OAAAC,oBAAA,CAAAL,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAI,qBAAA;EAAAA,oBAAA,GAAA7B,iBAAA,CAAlC,WAAmC8B,MAAM,EAAEb,MAAM,EAAE;IAC/C,MAAMc,SAAS,GAAGD,MAAM,CAACE,oBAAoB,CAAC,CAAC;IAC/C;IACA;IACA,MAAM,CAACC,CAAC,EAAEC,eAAe,CAAC,GAAGH,SAAS,CAACI,KAAK,CAAC,CAAC;IAC9C,MAAMnB,SAAS,GAAG,CACd,GAAGc,MAAM,CAACM,WAAW,EACrB,GAAGL,SAAS,EACZ,GAAGD,MAAM,CAACO,WAAW,EACrB,GAAGP,MAAM,CAACQ,WAAW,CACxB;IACD,MAAMC,qBAAqB,GAAG,CAAC,CAAC,EAAE7B,qBAAqB,CAAC8B,wBAAwB,EAAExB,SAAS,CAAC;IAC5F,MAAMyB,OAAO,CAACC,GAAG,CAAC3B,YAAY,CAACwB,qBAAqB,EAAEtB,MAAM,CAAC,CAAC;IAC9D,MAAM0B,kBAAkB,GAAG,CAAC,CAAC,EAAEjC,qBAAqB,CAACkC,qBAAqB,EAAE5B,SAAS,CAAC;IACtF,MAAMyB,OAAO,CAACC,GAAG,CAAC3B,YAAY,CAAC4B,kBAAkB,EAAE1B,MAAM,CAAC,CAAC;IAC3D;IACA,MAAM4B,mBAAmB,GAAGX,eAAe,CAACtB,QAAQ;IACpD,IAAIiC,mBAAmB,IACnBlC,oBAAoB,CAACkC,mBAAmB,CAAC,IACzCX,eAAe,CAACY,sBAAsB,CAAC,CAAC,EAAE;MAC1C,MAAMD,mBAAmB,CAAC/B,qBAAqB,CAACG,MAAM,CAAC;IAC3D;EACJ,CAAC;EAAA,OAAAY,oBAAA,CAAAL,KAAA,OAAAC,SAAA;AAAA","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}