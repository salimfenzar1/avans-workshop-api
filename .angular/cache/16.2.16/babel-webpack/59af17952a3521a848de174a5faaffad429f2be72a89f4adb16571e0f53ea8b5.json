{"ast":null,"code":"\"use strict\";\n\nvar _asyncToGenerator = require(\"C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@babel/runtime/helpers/asyncToGenerator.js\").default;\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ModuleRef = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst get_class_scope_1 = require(\"../helpers/get-class-scope\");\nconst is_durable_1 = require(\"../helpers/is-durable\");\nconst abstract_instance_resolver_1 = require(\"./abstract-instance-resolver\");\nconst injector_1 = require(\"./injector\");\nconst instance_links_host_1 = require(\"./instance-links-host\");\nconst instance_wrapper_1 = require(\"./instance-wrapper\");\nclass ModuleRef extends abstract_instance_resolver_1.AbstractInstanceResolver {\n  get instanceLinksHost() {\n    if (!this._instanceLinksHost) {\n      this._instanceLinksHost = new instance_links_host_1.InstanceLinksHost(this.container);\n    }\n    return this._instanceLinksHost;\n  }\n  constructor(container) {\n    super();\n    this.container = container;\n    this.injector = new injector_1.Injector();\n  }\n  introspect(token) {\n    const {\n      wrapperRef\n    } = this.instanceLinksHost.get(token);\n    let scope = common_1.Scope.DEFAULT;\n    if (!wrapperRef.isDependencyTreeStatic()) {\n      scope = common_1.Scope.REQUEST;\n    } else if (wrapperRef.isTransient) {\n      scope = common_1.Scope.TRANSIENT;\n    }\n    return {\n      scope\n    };\n  }\n  registerRequestByContextId(request, contextId) {\n    this.container.registerRequestProvider(request, contextId);\n  }\n  instantiateClass(type, moduleRef, contextId) {\n    var _this = this;\n    return _asyncToGenerator(function* () {\n      const wrapper = new instance_wrapper_1.InstanceWrapper({\n        name: type && type.name,\n        metatype: type,\n        isResolved: false,\n        scope: (0, get_class_scope_1.getClassScope)(type),\n        durable: (0, is_durable_1.isDurable)(type),\n        host: moduleRef\n      });\n      return new Promise( /*#__PURE__*/function () {\n        var _ref = _asyncToGenerator(function* (resolve, reject) {\n          try {\n            const callback = /*#__PURE__*/function () {\n              var _ref2 = _asyncToGenerator(function* (instances) {\n                const properties = yield _this.injector.resolveProperties(wrapper, moduleRef, undefined, contextId);\n                const instance = new type(...instances);\n                _this.injector.applyProperties(instance, properties);\n                resolve(instance);\n              });\n              return function callback(_x3) {\n                return _ref2.apply(this, arguments);\n              };\n            }();\n            yield _this.injector.resolveConstructorParams(wrapper, moduleRef, undefined, callback, contextId);\n          } catch (err) {\n            reject(err);\n          }\n        });\n        return function (_x, _x2) {\n          return _ref.apply(this, arguments);\n        };\n      }());\n    })();\n  }\n}\nexports.ModuleRef = ModuleRef;","map":{"version":3,"names":["_asyncToGenerator","require","default","Object","defineProperty","exports","value","ModuleRef","common_1","get_class_scope_1","is_durable_1","abstract_instance_resolver_1","injector_1","instance_links_host_1","instance_wrapper_1","AbstractInstanceResolver","instanceLinksHost","_instanceLinksHost","InstanceLinksHost","container","constructor","injector","Injector","introspect","token","wrapperRef","get","scope","Scope","DEFAULT","isDependencyTreeStatic","REQUEST","isTransient","TRANSIENT","registerRequestByContextId","request","contextId","registerRequestProvider","instantiateClass","type","moduleRef","_this","wrapper","InstanceWrapper","name","metatype","isResolved","getClassScope","durable","isDurable","host","Promise","_ref","resolve","reject","callback","_ref2","instances","properties","resolveProperties","undefined","instance","applyProperties","_x3","apply","arguments","resolveConstructorParams","err","_x","_x2"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/injector/module-ref.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ModuleRef = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst get_class_scope_1 = require(\"../helpers/get-class-scope\");\nconst is_durable_1 = require(\"../helpers/is-durable\");\nconst abstract_instance_resolver_1 = require(\"./abstract-instance-resolver\");\nconst injector_1 = require(\"./injector\");\nconst instance_links_host_1 = require(\"./instance-links-host\");\nconst instance_wrapper_1 = require(\"./instance-wrapper\");\nclass ModuleRef extends abstract_instance_resolver_1.AbstractInstanceResolver {\n    get instanceLinksHost() {\n        if (!this._instanceLinksHost) {\n            this._instanceLinksHost = new instance_links_host_1.InstanceLinksHost(this.container);\n        }\n        return this._instanceLinksHost;\n    }\n    constructor(container) {\n        super();\n        this.container = container;\n        this.injector = new injector_1.Injector();\n    }\n    introspect(token) {\n        const { wrapperRef } = this.instanceLinksHost.get(token);\n        let scope = common_1.Scope.DEFAULT;\n        if (!wrapperRef.isDependencyTreeStatic()) {\n            scope = common_1.Scope.REQUEST;\n        }\n        else if (wrapperRef.isTransient) {\n            scope = common_1.Scope.TRANSIENT;\n        }\n        return { scope };\n    }\n    registerRequestByContextId(request, contextId) {\n        this.container.registerRequestProvider(request, contextId);\n    }\n    async instantiateClass(type, moduleRef, contextId) {\n        const wrapper = new instance_wrapper_1.InstanceWrapper({\n            name: type && type.name,\n            metatype: type,\n            isResolved: false,\n            scope: (0, get_class_scope_1.getClassScope)(type),\n            durable: (0, is_durable_1.isDurable)(type),\n            host: moduleRef,\n        });\n        return new Promise(async (resolve, reject) => {\n            try {\n                const callback = async (instances) => {\n                    const properties = await this.injector.resolveProperties(wrapper, moduleRef, undefined, contextId);\n                    const instance = new type(...instances);\n                    this.injector.applyProperties(instance, properties);\n                    resolve(instance);\n                };\n                await this.injector.resolveConstructorParams(wrapper, moduleRef, undefined, callback, contextId);\n            }\n            catch (err) {\n                reject(err);\n            }\n        });\n    }\n}\nexports.ModuleRef = ModuleRef;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}