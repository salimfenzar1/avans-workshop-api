{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.StreamableFile = void 0;\nconst stream_1 = require(\"stream\");\nconst util_1 = require(\"util\");\nconst enums_1 = require(\"../enums\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst services_1 = require(\"../services\");\n/**\n * @see [Streaming files](https://docs.nestjs.com/techniques/streaming-files)\n *\n * @publicApi\n */\nclass StreamableFile {\n  constructor(bufferOrReadStream, options = {}) {\n    this.options = options;\n    this.logger = new services_1.Logger('StreamableFile');\n    this.handleError = (err, res) => {\n      if (res.destroyed) {\n        return;\n      }\n      if (res.headersSent) {\n        res.end();\n        return;\n      }\n      res.statusCode = enums_1.HttpStatus.BAD_REQUEST;\n      res.send(err.message);\n    };\n    this.logError = err => {\n      this.logger.error(err.message, err.stack);\n    };\n    if (util_1.types.isUint8Array(bufferOrReadStream)) {\n      this.stream = new stream_1.Readable();\n      this.stream.push(bufferOrReadStream);\n      this.stream.push(null);\n      this.options.length ??= bufferOrReadStream.length;\n    } else if (bufferOrReadStream.pipe && (0, shared_utils_1.isFunction)(bufferOrReadStream.pipe)) {\n      this.stream = bufferOrReadStream;\n    }\n  }\n  getStream() {\n    return this.stream;\n  }\n  getHeaders() {\n    const {\n      type = 'application/octet-stream',\n      disposition = undefined,\n      length = undefined\n    } = this.options;\n    return {\n      type,\n      disposition,\n      length\n    };\n  }\n  get errorHandler() {\n    return this.handleError;\n  }\n  setErrorHandler(handler) {\n    this.handleError = handler;\n    return this;\n  }\n  get errorLogger() {\n    return this.logError;\n  }\n  setErrorLogger(handler) {\n    this.logError = handler;\n    return this;\n  }\n}\nexports.StreamableFile = StreamableFile;","map":{"version":3,"names":["Object","defineProperty","exports","value","StreamableFile","stream_1","require","util_1","enums_1","shared_utils_1","services_1","constructor","bufferOrReadStream","options","logger","Logger","handleError","err","res","destroyed","headersSent","end","statusCode","HttpStatus","BAD_REQUEST","send","message","logError","error","stack","types","isUint8Array","stream","Readable","push","length","pipe","isFunction","getStream","getHeaders","type","disposition","undefined","errorHandler","setErrorHandler","handler","errorLogger","setErrorLogger"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/common/file-stream/streamable-file.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.StreamableFile = void 0;\nconst stream_1 = require(\"stream\");\nconst util_1 = require(\"util\");\nconst enums_1 = require(\"../enums\");\nconst shared_utils_1 = require(\"../utils/shared.utils\");\nconst services_1 = require(\"../services\");\n/**\n * @see [Streaming files](https://docs.nestjs.com/techniques/streaming-files)\n *\n * @publicApi\n */\nclass StreamableFile {\n    constructor(bufferOrReadStream, options = {}) {\n        this.options = options;\n        this.logger = new services_1.Logger('StreamableFile');\n        this.handleError = (err, res) => {\n            if (res.destroyed) {\n                return;\n            }\n            if (res.headersSent) {\n                res.end();\n                return;\n            }\n            res.statusCode = enums_1.HttpStatus.BAD_REQUEST;\n            res.send(err.message);\n        };\n        this.logError = (err) => {\n            this.logger.error(err.message, err.stack);\n        };\n        if (util_1.types.isUint8Array(bufferOrReadStream)) {\n            this.stream = new stream_1.Readable();\n            this.stream.push(bufferOrReadStream);\n            this.stream.push(null);\n            this.options.length ??= bufferOrReadStream.length;\n        }\n        else if (bufferOrReadStream.pipe && (0, shared_utils_1.isFunction)(bufferOrReadStream.pipe)) {\n            this.stream = bufferOrReadStream;\n        }\n    }\n    getStream() {\n        return this.stream;\n    }\n    getHeaders() {\n        const { type = 'application/octet-stream', disposition = undefined, length = undefined, } = this.options;\n        return {\n            type,\n            disposition,\n            length,\n        };\n    }\n    get errorHandler() {\n        return this.handleError;\n    }\n    setErrorHandler(handler) {\n        this.handleError = handler;\n        return this;\n    }\n    get errorLogger() {\n        return this.logError;\n    }\n    setErrorLogger(handler) {\n        this.logError = handler;\n        return this;\n    }\n}\nexports.StreamableFile = StreamableFile;\n"],"mappings":"AAAA,YAAY;;AACZA,MAAM,CAACC,cAAc,CAACC,OAAO,EAAE,YAAY,EAAE;EAAEC,KAAK,EAAE;AAAK,CAAC,CAAC;AAC7DD,OAAO,CAACE,cAAc,GAAG,KAAK,CAAC;AAC/B,MAAMC,QAAQ,GAAGC,OAAO,CAAC,QAAQ,CAAC;AAClC,MAAMC,MAAM,GAAGD,OAAO,CAAC,MAAM,CAAC;AAC9B,MAAME,OAAO,GAAGF,OAAO,CAAC,UAAU,CAAC;AACnC,MAAMG,cAAc,GAAGH,OAAO,CAAC,uBAAuB,CAAC;AACvD,MAAMI,UAAU,GAAGJ,OAAO,CAAC,aAAa,CAAC;AACzC;AACA;AACA;AACA;AACA;AACA,MAAMF,cAAc,CAAC;EACjBO,WAAWA,CAACC,kBAAkB,EAAEC,OAAO,GAAG,CAAC,CAAC,EAAE;IAC1C,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACC,MAAM,GAAG,IAAIJ,UAAU,CAACK,MAAM,CAAC,gBAAgB,CAAC;IACrD,IAAI,CAACC,WAAW,GAAG,CAACC,GAAG,EAAEC,GAAG,KAAK;MAC7B,IAAIA,GAAG,CAACC,SAAS,EAAE;QACf;MACJ;MACA,IAAID,GAAG,CAACE,WAAW,EAAE;QACjBF,GAAG,CAACG,GAAG,CAAC,CAAC;QACT;MACJ;MACAH,GAAG,CAACI,UAAU,GAAGd,OAAO,CAACe,UAAU,CAACC,WAAW;MAC/CN,GAAG,CAACO,IAAI,CAACR,GAAG,CAACS,OAAO,CAAC;IACzB,CAAC;IACD,IAAI,CAACC,QAAQ,GAAIV,GAAG,IAAK;MACrB,IAAI,CAACH,MAAM,CAACc,KAAK,CAACX,GAAG,CAACS,OAAO,EAAET,GAAG,CAACY,KAAK,CAAC;IAC7C,CAAC;IACD,IAAItB,MAAM,CAACuB,KAAK,CAACC,YAAY,CAACnB,kBAAkB,CAAC,EAAE;MAC/C,IAAI,CAACoB,MAAM,GAAG,IAAI3B,QAAQ,CAAC4B,QAAQ,CAAC,CAAC;MACrC,IAAI,CAACD,MAAM,CAACE,IAAI,CAACtB,kBAAkB,CAAC;MACpC,IAAI,CAACoB,MAAM,CAACE,IAAI,CAAC,IAAI,CAAC;MACtB,IAAI,CAACrB,OAAO,CAACsB,MAAM,KAAKvB,kBAAkB,CAACuB,MAAM;IACrD,CAAC,MACI,IAAIvB,kBAAkB,CAACwB,IAAI,IAAI,CAAC,CAAC,EAAE3B,cAAc,CAAC4B,UAAU,EAAEzB,kBAAkB,CAACwB,IAAI,CAAC,EAAE;MACzF,IAAI,CAACJ,MAAM,GAAGpB,kBAAkB;IACpC;EACJ;EACA0B,SAASA,CAAA,EAAG;IACR,OAAO,IAAI,CAACN,MAAM;EACtB;EACAO,UAAUA,CAAA,EAAG;IACT,MAAM;MAAEC,IAAI,GAAG,0BAA0B;MAAEC,WAAW,GAAGC,SAAS;MAAEP,MAAM,GAAGO;IAAW,CAAC,GAAG,IAAI,CAAC7B,OAAO;IACxG,OAAO;MACH2B,IAAI;MACJC,WAAW;MACXN;IACJ,CAAC;EACL;EACA,IAAIQ,YAAYA,CAAA,EAAG;IACf,OAAO,IAAI,CAAC3B,WAAW;EAC3B;EACA4B,eAAeA,CAACC,OAAO,EAAE;IACrB,IAAI,CAAC7B,WAAW,GAAG6B,OAAO;IAC1B,OAAO,IAAI;EACf;EACA,IAAIC,WAAWA,CAAA,EAAG;IACd,OAAO,IAAI,CAACnB,QAAQ;EACxB;EACAoB,cAAcA,CAACF,OAAO,EAAE;IACpB,IAAI,CAAClB,QAAQ,GAAGkB,OAAO;IACvB,OAAO,IAAI;EACf;AACJ;AACA3C,OAAO,CAACE,cAAc,GAAGA,cAAc","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}