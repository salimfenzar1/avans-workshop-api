{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.ModuleTokenFactory = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst random_string_generator_util_1 = require(\"@nestjs/common/utils/random-string-generator.util\");\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst crypto_1 = require(\"crypto\");\nconst fast_safe_stringify_1 = require(\"fast-safe-stringify\");\nconst perf_hooks_1 = require(\"perf_hooks\");\nconst CLASS_STR = 'class ';\nconst CLASS_STR_LEN = CLASS_STR.length;\nclass ModuleTokenFactory {\n  constructor() {\n    this.moduleTokenCache = new Map();\n    this.moduleIdsCache = new WeakMap();\n    this.logger = new common_1.Logger(ModuleTokenFactory.name, {\n      timestamp: true\n    });\n  }\n  create(metatype, dynamicModuleMetadata) {\n    const moduleId = this.getModuleId(metatype);\n    if (!dynamicModuleMetadata) {\n      return this.getStaticModuleToken(moduleId, this.getModuleName(metatype));\n    }\n    const opaqueToken = {\n      id: moduleId,\n      module: this.getModuleName(metatype),\n      dynamic: dynamicModuleMetadata\n    };\n    const start = perf_hooks_1.performance.now();\n    const opaqueTokenString = this.getStringifiedOpaqueToken(opaqueToken);\n    const timeSpentInMs = perf_hooks_1.performance.now() - start;\n    if (timeSpentInMs > 10) {\n      const formattedTimeSpent = timeSpentInMs.toFixed(2);\n      this.logger.warn(`The module \"${opaqueToken.module}\" is taking ${formattedTimeSpent}ms to serialize, this may be caused by larger objects statically assigned to the module. More details: https://github.com/nestjs/nest/issues/12738`);\n    }\n    return this.hashString(opaqueTokenString);\n  }\n  getStaticModuleToken(moduleId, moduleName) {\n    const key = `${moduleId}_${moduleName}`;\n    if (this.moduleTokenCache.has(key)) {\n      return this.moduleTokenCache.get(key);\n    }\n    const hash = this.hashString(key);\n    this.moduleTokenCache.set(key, hash);\n    return hash;\n  }\n  getStringifiedOpaqueToken(opaqueToken) {\n    // Uses safeStringify instead of JSON.stringify to support circular dynamic modules\n    // The replacer function is also required in order to obtain real class names\n    // instead of the unified \"Function\" key\n    return opaqueToken ? (0, fast_safe_stringify_1.default)(opaqueToken, this.replacer) : '';\n  }\n  getModuleId(metatype) {\n    let moduleId = this.moduleIdsCache.get(metatype);\n    if (moduleId) {\n      return moduleId;\n    }\n    moduleId = (0, random_string_generator_util_1.randomStringGenerator)();\n    this.moduleIdsCache.set(metatype, moduleId);\n    return moduleId;\n  }\n  getModuleName(metatype) {\n    return metatype.name;\n  }\n  hashString(value) {\n    return (0, crypto_1.createHash)('sha256').update(value).digest('hex');\n  }\n  replacer(key, value) {\n    if ((0, shared_utils_1.isFunction)(value)) {\n      const funcAsString = value.toString();\n      const isClass = funcAsString.slice(0, CLASS_STR_LEN) === CLASS_STR;\n      if (isClass) {\n        return value.name;\n      }\n      return funcAsString;\n    }\n    if ((0, shared_utils_1.isSymbol)(value)) {\n      return value.toString();\n    }\n    return value;\n  }\n}\nexports.ModuleTokenFactory = ModuleTokenFactory;","map":{"version":3,"names":["Object","defineProperty","exports","value","ModuleTokenFactory","common_1","require","random_string_generator_util_1","shared_utils_1","crypto_1","fast_safe_stringify_1","perf_hooks_1","CLASS_STR","CLASS_STR_LEN","length","constructor","moduleTokenCache","Map","moduleIdsCache","WeakMap","logger","Logger","name","timestamp","create","metatype","dynamicModuleMetadata","moduleId","getModuleId","getStaticModuleToken","getModuleName","opaqueToken","id","module","dynamic","start","performance","now","opaqueTokenString","getStringifiedOpaqueToken","timeSpentInMs","formattedTimeSpent","toFixed","warn","hashString","moduleName","key","has","get","hash","set","default","replacer","randomStringGenerator","createHash","update","digest","isFunction","funcAsString","toString","isClass","slice","isSymbol"],"sources":["C:/Users/salim/Dev/avans-nx-workshop-2024/avans-nx-workshop/node_modules/@nestjs/core/injector/module-token-factory.js"],"sourcesContent":["\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.ModuleTokenFactory = void 0;\nconst common_1 = require(\"@nestjs/common\");\nconst random_string_generator_util_1 = require(\"@nestjs/common/utils/random-string-generator.util\");\nconst shared_utils_1 = require(\"@nestjs/common/utils/shared.utils\");\nconst crypto_1 = require(\"crypto\");\nconst fast_safe_stringify_1 = require(\"fast-safe-stringify\");\nconst perf_hooks_1 = require(\"perf_hooks\");\nconst CLASS_STR = 'class ';\nconst CLASS_STR_LEN = CLASS_STR.length;\nclass ModuleTokenFactory {\n    constructor() {\n        this.moduleTokenCache = new Map();\n        this.moduleIdsCache = new WeakMap();\n        this.logger = new common_1.Logger(ModuleTokenFactory.name, {\n            timestamp: true,\n        });\n    }\n    create(metatype, dynamicModuleMetadata) {\n        const moduleId = this.getModuleId(metatype);\n        if (!dynamicModuleMetadata) {\n            return this.getStaticModuleToken(moduleId, this.getModuleName(metatype));\n        }\n        const opaqueToken = {\n            id: moduleId,\n            module: this.getModuleName(metatype),\n            dynamic: dynamicModuleMetadata,\n        };\n        const start = perf_hooks_1.performance.now();\n        const opaqueTokenString = this.getStringifiedOpaqueToken(opaqueToken);\n        const timeSpentInMs = perf_hooks_1.performance.now() - start;\n        if (timeSpentInMs > 10) {\n            const formattedTimeSpent = timeSpentInMs.toFixed(2);\n            this.logger.warn(`The module \"${opaqueToken.module}\" is taking ${formattedTimeSpent}ms to serialize, this may be caused by larger objects statically assigned to the module. More details: https://github.com/nestjs/nest/issues/12738`);\n        }\n        return this.hashString(opaqueTokenString);\n    }\n    getStaticModuleToken(moduleId, moduleName) {\n        const key = `${moduleId}_${moduleName}`;\n        if (this.moduleTokenCache.has(key)) {\n            return this.moduleTokenCache.get(key);\n        }\n        const hash = this.hashString(key);\n        this.moduleTokenCache.set(key, hash);\n        return hash;\n    }\n    getStringifiedOpaqueToken(opaqueToken) {\n        // Uses safeStringify instead of JSON.stringify to support circular dynamic modules\n        // The replacer function is also required in order to obtain real class names\n        // instead of the unified \"Function\" key\n        return opaqueToken ? (0, fast_safe_stringify_1.default)(opaqueToken, this.replacer) : '';\n    }\n    getModuleId(metatype) {\n        let moduleId = this.moduleIdsCache.get(metatype);\n        if (moduleId) {\n            return moduleId;\n        }\n        moduleId = (0, random_string_generator_util_1.randomStringGenerator)();\n        this.moduleIdsCache.set(metatype, moduleId);\n        return moduleId;\n    }\n    getModuleName(metatype) {\n        return metatype.name;\n    }\n    hashString(value) {\n        return (0, crypto_1.createHash)('sha256').update(value).digest('hex');\n    }\n    replacer(key, value) {\n        if ((0, shared_utils_1.isFunction)(value)) {\n            const funcAsString = value.toString();\n            const isClass = funcAsString.slice(0, CLASS_STR_LEN) === CLASS_STR;\n            if (isClass) {\n                return value.name;\n            }\n            return funcAsString;\n        }\n        if ((0, shared_utils_1.isSymbol)(value)) {\n            return value.toString();\n        }\n        return value;\n    }\n}\nexports.ModuleTokenFactory = ModuleTokenFactory;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"script","externalDependencies":[]}